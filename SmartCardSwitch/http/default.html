<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>SmartCardSwitch</title>
</head>
<body onclick="onElementClicked()">

<h1>SmartCardSwitch Config Server</h1>

<div>
	<button type="button" id="deviceQuery">Query</button>
</div>

<div>
	<p> stepper0
	<div>
		<div>
			<label>MIN:</label><label id="stepper_0_minOffset">0</label>
			<label>   Current:</label><label id="stepper0CurOffset"></label>
			<label>   MAX:</label><label id="stepper0MaxOffset"></label><br>
			<label>Steps:</label>
			<input type="number" id="stepper0Steps"></input>
			<button type="button" id="stepper_0_decrease">-</button>
			<button type="button" id="stepper_0_increase">+</button>
		</div>
		<div>
			<button type="button" id="stepper_0_decrease32">-32</button>
			<button type="button" id="stepper_0_decrease16">-16</button>
			<button type="button" id="stepper_0_decrease8">-8</button>
			<button type="button" id="stepper_0_decrease4">-4</button>
			<button type="button" id="stepper_0_decrease1">-1</button>
			<button type="button" id="stepper_0_increase1">+1</button>
			<button type="button" id="stepper_0_increase4">+4</button>
			<button type="button" id="stepper_0_increase8">+8</button>
			<button type="button" id="stepper_0_increase16">+16</button>
			<button type="button" id="stepper_0_increase32">+32</button>
		</div>
		<div>
			lowClks:<input type="number" id="stepper0LowClks" min="0" max="65535" size="5"></input>
			highClks:<input type="number" id="stepper0HighClks" min="0" max="65535" size="5"></input><br>
			accelerationBuffer:<input type="number" id="stepper0AccelerationBuffer" min="0" max="65535" size="5"></input>
			accelerationBufferDecrement:<input type="number" id="stepper0AccelerationBufferDecrement" min="0" max="65535" size="5"></input><br>
			decelerationBuffer:<input type="number" id="stepper0DecelerationBuffer" min="0" max="65535" size="5"></input>
			decelerationBufferIncrement:<input type="number" id="stepper0DecelerationBufferIncrement" min="0" max="65535" size="5"></input><br>
			<button type="button" id="stepper_0_configMovement">Config Movement</button>
		</div>
	</div>
</div>

<div>
	<p> stepper1
	<div>
		<div>
			<label>MIN:</label><label id="stepper_1_minOffset">0</label>
			<label>   Current:</label><label id="stepper1CurOffset"></label>
			<label>   MAX:</label><label id="stepper1MaxOffset"></label><br>
			<label>Steps:</label>
			<input type="number" id="stepper1Steps"></input>
			<button type="button" id="stepper_1_decrease">-</button>
			<button type="button" id="stepper_1_increase">+</button>
		</div>
		<div>
			<button type="button" id="stepper_1_decrease32">-32</button>
			<button type="button" id="stepper_1_decrease16">-16</button>
			<button type="button" id="stepper_1_decrease8">-8</button>
			<button type="button" id="stepper_1_decrease4">-4</button>
			<button type="button" id="stepper_1_decrease1">-1</button>
			<button type="button" id="stepper_1_increase1">+1</button>
			<button type="button" id="stepper_1_increase4">+4</button>
			<button type="button" id="stepper_1_increase8">+8</button>
			<button type="button" id="stepper_1_increase16">+16</button>
			<button type="button" id="stepper_1_increase32">+32</button>
		</div>
		<div>
			lowClks:<input type="number" id="stepper1LowClks" min="0" max="65535" size="5"></input>
			highClks:<input type="number" id="stepper1HighClks" min="0" max="65535" size="5"></input><br>
			accelerationBuffer:<input type="number" id="stepper1AccelerationBuffer" min="0" max="65535" size="5"></input>
			accelerationBufferDecrement:<input type="number" id="stepper1AccelerationBufferDecrement" min="0" max="65535" size="5"></input><br>
			decelerationBuffer:<input type="number" id="stepper1DecelerationBuffer" min="0" max="65535" size="5"></input>
			decelerationBufferIncrement:<input type="number" id="stepper1DecelerationBufferIncrement" min="0" max="65535" size="5"></input><br>
			<button type="button" id="stepper_1_configMovement">Config Movement</button>
		</div>
	</div>
</div>

<div>
	<p> stepper2
	<div>
		<div>
			<label>MIN:</label><label id="stepper_2_minOffset">0</label>
			<label>   Current:</label><label id="stepper2CurOffset"></label>
			<label>   MAX:</label><label id="stepper2MaxOffset"></label><br>
			<label>Steps:</label>
			<input type="number" id="stepper2Steps"></input>
			<button type="button" id="stepper_2_decrease">-</button>
			<button type="button" id="stepper_2_increase">+</button>
		</div>
		<div>
			<button type="button" id="stepper_2_decrease32">-32</button>
			<button type="button" id="stepper_2_decrease16">-16</button>
			<button type="button" id="stepper_2_decrease8">-8</button>
			<button type="button" id="stepper_2_decrease4">-4</button>
			<button type="button" id="stepper_2_decrease1">-1</button>
			<button type="button" id="stepper_2_increase1">+1</button>
			<button type="button" id="stepper_2_increase4">+4</button>
			<button type="button" id="stepper_2_increase8">+8</button>
			<button type="button" id="stepper_2_increase16">+16</button>
			<button type="button" id="stepper_2_increase32">+32</button>
		</div>
		<div>
			lowClks:<input type="number" id="stepper2LowClks" min="0" max="65535" size="5"></input>
			highClks:<input type="number" id="stepper2HighClks" min="0" max="65535" size="5"></input><br>
			accelerationBuffer:<input type="number" id="stepper2AccelerationBuffer" min="0" max="65535" size="5"></input>
			accelerationBufferDecrement:<input type="number" id="stepper2AccelerationBufferDecrement" min="0" max="65535" size="5"></input><br>
			decelerationBuffer:<input type="number" id="stepper2DecelerationBuffer" min="0" max="65535" size="5"></input>
			decelerationBufferIncrement:<input type="number" id="stepper2DecelerationBufferIncrement" min="0" max="65535" size="5"></input><br>
			<button type="button" id="stepper_2_configMovement">Config Movement</button>
		</div>
	</div>
</div>

<div>
	<p> stepper3
	<div>
		<div>
			<label>MIN:</label><label id="stepper_3_minOffset">0</label>
			<label>   Current:</label><label id="stepper3CurOffset"></label>
			<label>   MAX:</label><label id="stepper3MaxOffset"></label><br>
			<label>Steps:</label>
			<input type="number" id="stepper3Steps"></input>
			<button type="button" id="stepper_3_decrease">-</button>
			<button type="button" id="stepper_3_increase">+</button>
		</div>
		<div>
			<button type="button" id="stepper_3_decrease32">-32</button>
			<button type="button" id="stepper_3_decrease16">-16</button>
			<button type="button" id="stepper_3_decrease8">-8</button>
			<button type="button" id="stepper_3_decrease4">-4</button>
			<button type="button" id="stepper_3_decrease1">-1</button>
			<button type="button" id="stepper_3_increase1">+1</button>
			<button type="button" id="stepper_3_increase4">+4</button>
			<button type="button" id="stepper_3_increase8">+8</button>
			<button type="button" id="stepper_3_increase16">+16</button>
			<button type="button" id="stepper_3_increase32">+32</button>
		</div>
		<div>
			lowClks:<input type="number" id="stepper3LowClks" min="0" max="65535" size="5"></input>
			highClks:<input type="number" id="stepper3HighClks" min="0" max="65535" size="5"></input><br>
			accelerationBuffer:<input type="number" id="stepper3AccelerationBuffer" min="0" max="65535" size="5"></input>
			accelerationBufferDecrement:<input type="number" id="stepper3AccelerationBufferDecrement" min="0" max="65535" size="5"></input><br>
			decelerationBuffer:<input type="number" id="stepper3DecelerationBuffer" min="0" max="65535" size="5"></input>
			decelerationBufferIncrement:<input type="number" id="stepper3DecelerationBufferIncrement" min="0" max="65535" size="5"></input><br>
			<button type="button" id="stepper_3_configMovement">Config Movement</button>
		</div>
	</div>
</div>

<div>
	<p> stepper4
	<div>
		<div>
			<label>MIN:</label><label id="stepper_4_minOffset">0</label>
			<label>   Current:</label><label id="stepper4CurOffset"></label>
			<label>   MAX:</label><label id="stepper4MaxOffset"></label><br>
			<label>Steps:</label>
			<input type="number" id="stepper4Steps"></input>
			<button type="button" id="stepper_4_decrease">-</button>
			<button type="button" id="stepper_4_increase">+</button>
		</div>
		<div>
			<button type="button" id="stepper_4_decrease32">-32</button>
			<button type="button" id="stepper_4_decrease16">-16</button>
			<button type="button" id="stepper_4_decrease8">-8</button>
			<button type="button" id="stepper_4_decrease4">-4</button>
			<button type="button" id="stepper_4_decrease1">-1</button>
			<button type="button" id="stepper_4_increase1">+1</button>
			<button type="button" id="stepper_4_increase4">+4</button>
			<button type="button" id="stepper_4_increase8">+8</button>
			<button type="button" id="stepper_4_increase16">+16</button>
			<button type="button" id="stepper_4_increase32">+32</button>
		</div>
		<div>
			lowClks:<input type="number" id="stepper4LowClks" min="0" max="65535" size="5"></input>
			highClks:<input type="number" id="stepper4HighClks" min="0" max="65535" size="5"></input><br>
			accelerationBuffer:<input type="number" id="stepper4AccelerationBuffer" min="0" max="65535" size="5"></input>
			accelerationBufferDecrement:<input type="number" id="stepper4AccelerationBufferDecrement" min="0" max="65535" size="5"></input><br>
			decelerationBuffer:<input type="number" id="stepper4DecelerationBuffer" min="0" max="65535" size="5"></input>
			decelerationBufferIncrement:<input type="number" id="stepper4DecelerationBufferIncrement" min="0" max="65535" size="5"></input><br>
			<button type="button" id="stepper_4_configMovement">Config Movement</button>
		</div>
	</div>
</div>


<div>
	<div>
		<label>locator0: </label><label id="locator0Value"></label>
	</div>
	<div>
		<label>locator1: </label><label id="locator1Value"></label>
	</div>
	<div>
		<label>locator2: </label><label id="locator2Value"></label>
	</div>
	<div>
		<label>locator3: </label><label id="locator3Value"></label>
	</div>
	<div>
		<label>locator4: </label><label id="locator4Value"></label>
	</div>
	<div>
		<label>locator5: </label><label id="locator5Value"></label>
	</div>
	<div>
		<label>locator6: </label><label id="locator6Value"></label>
	</div>
	<div>
		<label>locator7: </label><label id="locator7Value"></label>
	</div>
</div>

<div>
	<div>
		<label>bdc0: </label>
		<input name="bdc0" id="bdc_0_Release" type="radio"><label for="bdc_0_Release">Release</label>
		<input name="bdc0" id="bdc_0_Forward" type="radio"><label for="bdc_0_Forward">Forward</label>
		<input name="bdc0" id="bdc_0_Reverse" type="radio"><label for="bdc_0_Reverse">Reverse</label>
	</div>
	<div>
		<label>bdc1: </label>
		<input name="bdc1" id="bdc_1_Release" type="radio"><label for="bdc_1_Release">Release</label>
		<input name="bdc1" id="bdc_1_Forward" type="radio"><label for="bdc_1_Forward">Forward</label>
		<input name="bdc1" id="bdc_1_Reverse" type="radio"><label for="bdc_1_Reverse">Reverse</label>
	</div>
	<div>
		<label>bdc2: </label>
		<input name="bdc2" id="bdc_2_Release" type="radio"><label for="bdc_2_Release">Release</label>
		<input name="bdc2" id="bdc_2_Forward" type="radio"><label for="bdc_2_Forward">Forward</label>
		<input name="bdc2" id="bdc_2_Reverse" type="radio"><label for="bdc_2_Reverse">Reverse</label>
	</div>
	<div>
		<label>bdc3: </label>
		<input name="bdc3" id="bdc_3_Release" type="radio"><label for="bdc_3_Release">Release</label>
		<input name="bdc3" id="bdc_3_Forward" type="radio"><label for="bdc_3_Forward">Forward</label>
		<input name="bdc3" id="bdc_3_Reverse" type="radio"><label for="bdc_3_Reverse">Reverse</label>
	</div>
	<div>
		<label>bdc4: </label>
		<input name="bdc4" id="bdc_4_Release" type="radio"><label for="bdc_4_Release">Release</label>
		<input name="bdc4" id="bdc_4_Forward" type="radio"><label for="bdc_4_Forward">Forward</label>
		<input name="bdc4" id="bdc_4_Reverse" type="radio"><label for="bdc_4_Reverse">Reverse</label>
	</div>
	<div>
		<label>bdc5: </label>
		<input name="bdc5" id="bdc_5_Release" type="radio"><label for="bdc_5_Release">Release</label>
		<input name="bdc5" id="bdc_5_Forward" type="radio"><label for="bdc_5_Forward">Forward</label>
		<input name="bdc5" id="bdc_5_Reverse" type="radio"><label for="bdc_5_Reverse">Reverse</label>
	</div>
</div>

<div>
	Device is connected: <input type="checkbox" id="deviceConnected">
</div>
<div>
	Device is powered: <input type="checkbox" id="devicePowered">
</div>
<div>
	Device fuse is ok: <input type="checkbox" id="deviceFuseOk">
</div>
<div>
	OPT is powered: <input type="checkbox" id="optPowered">
</div>
<div>
	BDCs are powered: <input type="checkbox" id="bdcsPowered">
</div>
<div>
	Steppers are powered: <input type="checkbox" id="steppersPowered">
</div>


<script>

function updatePageStepper(stepper, data)
{
	var elementId;

	elementId = stepper + "CurOffset";
	document.getElementById(elementId).innerHTML = data["homeOffset"].toString();
	elementId = stepper + "MaxOffset";
	document.getElementById(elementId).innerHTML = data["maximum"].toString();
	elementId = stepper + "LowClks";
	document.getElementById(elementId).value = data["lowClks"].toString();
	elementId = stepper + "HighClks";
	document.getElementById(elementId).value = data["highClks"].toString();
	elementId = stepper + "AccelerationBuffer";
	document.getElementById(elementId).value = data["accelerationBuffer"].toString();
	elementId = stepper + "AccelerationBufferDecrement";
	document.getElementById(elementId).value = data["accelerationBufferDecrement"].toString();
	elementId = stepper + "DecelerationBuffer";
	document.getElementById(elementId).value = data["decelerationBuffer"].toString();
	elementId = stepper + "DecelerationBufferIncrement";
	document.getElementById(elementId).value = data["decelerationBufferIncrement"].toString();
}

function updatePageLocator(locator, data)
{
	var elementId = locator + "Value";
	document.getElementById(elementId).innerHTML = data.toString();
}

function updatePageBdc(bdc, data)
{
	var elementId;
	
	if(data == 0) {
		//forward
		elementId = bdc + "Forward";
		document.getElementById(elementId).checked = true;
	}
	else if(data == 1) {
		//reverse
		elementId = bdc + "Reverse";
		document.getElementById(elementId).checked = true;
	}
	else if(data == 2) {
		//release
		elementId = bdc + "Release";
		document.getElementById(elementId).checked = true;
	}
	else {
		console.log("Error: wrong bdc status: " + bdc + " " + data.toString());
	}
}

function updatePageDeviceConnected(bConnected)
{
	document.getElementById("deviceConnected").checked = bConnected;
}

function updatePageDevicePowered(bPowered)
{
	document.getElementById("devicePowered").checked = bPowered;
}

function updatePageDeviceFuseOk(bOk)
{
	document.getElementById("deviceFuseOk").checked = bOk;	
}

function updatePageOptPowered(bPowered)
{
	document.getElementById("optPowered").checked = bPowered;
}

function updatePageBdcPowered(bPowered)
{
	document.getElementById("bdcsPowered").checked = bPowered;
}

function updatePageStepperPowered(bPowered)
{
	document.getElementById("steppersPowered").checked = bPowered;
}


function updatePage(serverResponse)
{
	for(key in serverResponse) 
	{
		if(key === "stepper0")  {
			updatePageStepper(key, serverResponse[key]);
		}
		else if(key === "stepper1") {
			updatePageStepper(key, serverResponse[key]);
		}
		else if(key === "stepper2") {
			updatePageStepper(key, serverResponse[key]);
		}
		else if(key === "stepper3") {
			updatePageStepper(key, serverResponse[key]);
		}
		else if(key === "stepper4") {
			updatePageStepper(key, serverResponse[key]);
		}
		else if(key === "locator0") {
			updatePageLocator(key, serverResponse[key]);
		}
		else if(key === "locator1") {
			updatePageLocator(key, serverResponse[key]);
		}
		else if(key === "locator2") {
			updatePageLocator(key, serverResponse[key]);
		}
		else if(key === "locator3") {
			updatePageLocator(key, serverResponse[key]);
		}
		else if(key === "locator4") {
			updatePageLocator(key, serverResponse[key]);
		}
		else if(key === "locator5") {
			updatePageLocator(key, serverResponse[key]);
		}
		else if(key === "locator6") {
			updatePageLocator(key, serverResponse[key]);
		}
		else if(key === "locator7") {
			updatePageLocator(key, serverResponse[key]);
		}
		else if(key === "bdc0") {
			updatePageBdc("bdc_0_", serverResponse[key]);
		}
		else if(key === "bdc1") {
			updatePageBdc("bdc_1_", serverResponse[key]);
		}
		else if(key === "bdc2") {
			updatePageBdc("bdc_2_", serverResponse[key]);
		}
		else if(key === "bdc3") {
			updatePageBdc("bdc_3_", serverResponse[key]);
		}
		else if(key === "bdc4") {
			updatePageBdc("bdc_4_", serverResponse[key]);
		}
		else if(key === "bdc5") {
			updatePageBdc("bdc_5_", serverResponse[key]);
		}
		else if(key === "deviceConnected") {
			updatePageDeviceConnected(serverResponse[key]);
		}
		else if(key === "devicePowered") {
			updatePageDevicePowered(serverResponse[key]);
		}
		else if(key === "deviceFuseOk") {
			updatePageDeviceFuseOk(serverResponse[key]);
		}
		else if(key === "optPowered") {
			updatePageOptPowered(serverResponse[key]);
		}
		else if(key === "bdcPowered") {
			updatePageBdcPowered(serverResponse[key]);
		}
		else if(key === "stepperPowered") {
			updatePageStepperPowered(serverResponse[key]);
		}
		else {
			console.log('Error: ' + "unexpected item in server response: " + key);
		}
	}
}

function moveStepper(stepper, forward, steps)
{
	var xhr = new XMLHttpRequest();
	xhr.responseType = "json";
	xhr.open('POST', 'stepperMove');
	
	xhr.onreadystatechange = function () {
		var DONE = 4; // readyState 4 means the request is done.
		var OK = 200; // status 200 is a successful return.
		if (xhr.readyState === DONE) {
			console.log("response is available");
			console.log("response type: " + xhr.responseType);

			if (xhr.status === OK) 
			{
				var jsonObj = xhr.response;
				console.log(JSON.stringify(jsonObj)); // 'This is the output.'
				updatePage(jsonObj);
			} else {
				console.log('Error: ' + xhr.status); // An error occurred during the request.
			}
		}
	};
	
	var parameters = {};
	//stepper index
	if(stepper === "stepper0") {
		parameters["index"] = 0;
	}
	else if(stepper === "stepper1") {
		parameters["index"] = 1;
	}
	else if(stepper === "stepper2") {
		parameters["index"] = 2;
	}
	else if(stepper === "stepper3") {
		parameters["index"] = 3;
	}
	else {
		alert("Wrong stepper: " + stepper);
		return;
	}
	//direction
	if(forward == true) {
		parameters["forward"] = true;
	}
	else {
		parameters["forward"] = false;
	}
	parameters["steps"] = steps;
	
	xhr.send(JSON.stringify(parameters));
}

function setBdc(index, action)
{
	var xhr = new XMLHttpRequest();
	xhr.responseType = "json";
	xhr.open('POST', 'bdc');
	
	xhr.onreadystatechange = function () {
		var DONE = 4; // readyState 4 means the request is done.
		var OK = 200; // status 200 is a successful return.
		if (xhr.readyState === DONE) {
			console.log("response is available");
			console.log("response type: " + xhr.responseType);

			if (xhr.status === OK) 
			{
				var jsonObj = xhr.response;
				console.log(JSON.stringify(jsonObj)); // 'This is the output.'
				updatePage(jsonObj);
			} else {
				console.log('Error: ' + xhr.status); // An error occurred during the request.
			}
		}
	};
	
	var parameters = {};
	parameters["index"] = index;
	parameters["action"] = action;
	
	xhr.send(JSON.stringify(parameters));}

function queryDevice()
{
	var xhr = new XMLHttpRequest();
	xhr.responseType = "json";
	xhr.open('POST', 'query');	

	xhr.onreadystatechange = function () {
		var DONE = 4; // readyState 4 means the request is done.
		var OK = 200; // status 200 is a successful return.
		if (xhr.readyState === DONE) {
			console.log("response is available");
			console.log("response type: " + xhr.responseType);

			if (xhr.status === OK) 
			{
				var jsonObj = xhr.response;
				console.log(JSON.stringify(jsonObj)); // 'This is the output.'
				updatePage(jsonObj);
			} else {
				console.log('Error: ' + xhr.status); // An error occurred during the request.
			}
		}
	};
	
	xhr.send();
}


function onStepperDecrease(stepper) {
	var stepsId = stepper + "Steps";
	var steps = document.getElementById(stepsId).value;
	moveStepper(stepper, false, steps);
}

function onStepperIncrease(stepper) {
	var stepsId = stepper + "Steps";
	var steps = document.getElementById(stepsId).value;
	moveStepper(stepper, true, steps);
}

function onStepperConfigMovement(stepper) {
	
}

function onElementClicked()
{
	var elementId = document.activeElement.id;
	var paraArray = elementId.split("_");

	var device = paraArray[0];
	if(device === "stepper") 
	{
		var index = paraArray[1];
		var action = paraArray[2];

		if(action === "decrease") {
			onStepperDecrease(device + index);
		}
		else if(action === "decrease32") {
			moveStepper(device + index, false, 32);
		}
		else if(action === "decrease16") {
			moveStepper(device + index, false, 16);
		}
		else if(action === "decrease8") {
			moveStepper(device + index, false, 8);
		}
		else if(action === "decrease1") {
			moveStepper(device + index, false, 1);
		}
		else if(action === "increase") {
			onStepperIncrease(device + index);
		}
		else if(action === "increase32") {
			moveStepper(device + index, true, 32);
		}
		else if(action === "increase16") {
			moveStepper(device + index, true, 16);
		}
		else if(action === "increase8") {
			moveStepper(device + index, true, 8);
		}
		else if(action === "increase1") {
			moveStepper(device + index, true, 1);
		}
		else if(action === "configMovement") {
			onStepperConfigMovement(device + index);
		}
	}
	else if(device === "bdc")
	{
		var index = parseInt(paraArray[1]);
		var action = paraArray[2];

		if(action === "Forward") {
			setBdc(index, 0);
		}
		else if (action === "Reverse") {
			setBdc(index, 1);
		}
		else if (action === "Release") {
			setBdc(index, 2);
		}
		else {
			console.log("Error: wrong bdc action: " + action);
		}
	}
	else if(elementId === "deviceQuery") {
		queryDevice();
	}
}

</script>

</body>
</html>
